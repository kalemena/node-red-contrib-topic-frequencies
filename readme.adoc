= Topic Frequencies

Computes frequencies of events per topic on a sliding interval.

This node is inspired by link:https://flows.nodered.org/node/node-red-contrib-metric-per-topic[node-red-contrib-metric-per-topic]

.Key features:
- Passthrough node, capturing metrics and let original message pass through
- Interval is sliding time window, allowing to report anytime and always have full *interval* data metrics
- Ability to specify *topic key* and *value key* measured, as JSON dot path (e.g. *payload.uniqueid*)
- Ability to specify *report* scheduler, distinct from *interval*
- Ability to *control* few operations, like *reset* counters, which can be triggered by Input node

image:docs/example-flow.png[Example Flow]

== Testing

The repo comes with simple Docker environment for testing.

.Build
[source,bash]
----
$ docker-compose build
----

.Start
[source,bash]
----
$ docker-compose up -d
----

.Browse to link:http://localhost:2880[]

.Edit Flow and check debug window on the right for metric messages

.Stop
[source,bash]
----
$ docker-compose down
----

.Sample output
[source,json]
----
{
    "topics": {
        "toto": {
            "intervalCount": 450,
            "intervalCountAvg": 6.081081081081081,
            "intervalCountMin": 5,
            "intervalCountMax": 15,
            "intervalMessageCount": 74
        },
        "titi": {
            "intervalCount": 40,
            "intervalCountAvg": 10,
            "intervalCountMin": 10,
            "intervalCountMax": 10,
            "intervalMessageCount": 4
        },
        "<all>": {
            "intervalCount": 490,
            "intervalCountAvg": 6.282051282051282,
            "intervalCountMin": 5,
            "intervalCountMax": 15,
            "intervalMessageCount": 78
        }
    },
    "cycles": 2476,
    "interval": 1,
    "units": "minutes",
    "topicKey": "payload.uniqueid",
    "valueKey": "payload.temp",
    "alignToClock": true,
    "_msgid": "b1bb6c79.43cb4"
}
----